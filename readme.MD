# Проект ModuleCD

## Описание

ModuleCD - это микросервис компаньон для ModuleCI, написанный на языке Go, который автоматизирует процесс перемещения файлов и перезапуска служб. Программа сканирует директорию CI/CD, перемещает файлы с расширением `.jar` и перезапускает соответствующие службы.

## Установка

1. Клонируйте репозиторий:
    ```sh
    git clone https://github.com/ваш-аккаунт/ModuleCD.git
    ```

2. Перейдите в директорию проекта:
    ```sh
    cd ModuleCD
    ```

3. Установите зависимости:
    ```sh
    go mod tidy
    ```

## Конфигурация

Создайте файл конфигурации `CICD/cicd.conf` со следующим содержимым:
```hcl
cd {
    cicd = "путь/до/вашей/директории/CICD" - где будут находиться каталоги вида "Test.jar"
    work = "путь/до/вашей/рабочей/директории" - здесь находятся файлы .jar, которые будут автоматически обновляться
}
```
## Важно
Каталоги в CICD должны иметь то же имя что и файлы .jar, в рабочей директории! 
Например файл в рабочей директории называется `TestBot.jar`, тогда в CICD должен быть каталог `TestBot.jar`
Так же в каталоге `TestBot.jar` должен быть файл .service который зарегистрирован в systemctl для перезапуска сервиса, например `TestBot.service`

## Запуск

Для запуска проекта выполните:
```sh
go run main.go
```

## Логирование

Логи программы по умолчанию сохраняются в файл `/var/log/info-bot/ModuleCD/ModuleCD.log`. Вы можете изменить путь к файлу логов в функции `init()` в файле `main.go`.

## Основные функции

- **checkDir()**: Сканирует директорию CI/CD на наличие новых файлов.
- **findJar(newDir os.DirEntry)**: Ищет файлы с расширением `.jar` в указанной директории.
- **moveOldFile(targetDir string)**: Перемещает старые файлы в директорию CI/CD с расширением `.old`.
- **moveNewFile(targetDir string, fileName string)**: Перемещает новые файлы из CI/CD в рабочую директорию.
- **restartService(targetDir string)**: Перезапускает службу, соответствующую найденному файлу `.service`.

## Авторы

- [kermy](https://github.com/ikermy)

## Лицензия

Этот проект лицензирован на условиях лицензии MIT. Подробности см. в файле `LICENSE`.